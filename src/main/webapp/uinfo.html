<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>个人信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="./layui/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <link href="css/base.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">
    <link href="css/m.css" rel="stylesheet">
    <script src="js/jquery-2.1.1.min.js"></script>
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" type="text/css" href="./layui/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="./css/comment.css" media="all">
    <style>
        .tb{
            color: white;
        }
        .btn-ic{
            float:right;
        }
    </style>
    <script>
        window.onload = function ()
        {
            var oH2 = document.getElementsByTagName("h2")[0];
            var oUl = document.getElementsByTagName("ul")[0];
            oH2.onclick = function ()
            {
                var style = oUl.style;
                style.display = style.display == "block" ? "none" : "block";
                oH2.className = style.display == "block" ? "open" : ""
            }
        }
    </script>
</head>
<body>
<header>
    <div class="tophead">
        <div class="logo"><a href="index.html">DCF个人博客</a></div>
        <div id="mnav">
            <h2><span class="navicon"></span></h2>
            <ul>
                <li><a href="index.html">网站首页</a></li>


                <li><a href="gbook.html">留言</a></li>
            </ul>
        </div>
        <nav class="topnav" id="topnav">
            <ul>
                <li><a href="index.html">网站首页</a></li>

                <li><i class="iconfont">&#xe69e;</i><a href="gbook.html">留言</a></li>
                <li id="login"></li>
                <li id="collect"></li>
                <li id="out"></li>
            </ul>
        </nav>
    </div>
</header>
<article>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
        <legend>个人信息</legend>
    </fieldset>

    <div style="padding: 20px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header"  >头像 </div>
                    <div class="layui-card-body" id="tx">
                        <img  id="tximg" width="200px" height="200px" src="" >
                    </div>
                </div>
            </div>

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">修改头像<button id="updateImg" type="button" class="layui-btn layui-btn-normal layui-btn-sm btn-ic"><i class="layui-icon tb"></i></button></div>
                    <div class="layui-card-body" id="img">

                    </div>
                </div>
            </div>

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header"  >账号   </div>
                    <div class="layui-card-body" id="zh">

                    </div>
                </div>
            </div>

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">注册时间</div>
                    <div class="layui-card-body" id="reg">

                    </div>
                </div>
            </div>
            <input type="hidden" id="uid"/>
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">昵称<button id="nc" type="button" class="layui-btn layui-btn-normal layui-btn-sm btn-ic"><i class="layui-icon tb"></i></button></div>
                    <div class="layui-card-body" id="nick">

                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">邮箱<button id="yx" type="button" class="layui-btn layui-btn-normal layui-btn-sm btn-ic"><i class="layui-icon tb"></i></button></div>
                    <div class="layui-card-body" id="email">

                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">手机<button id="sj" type="button" class="layui-btn layui-btn-normal layui-btn-sm btn-ic"><i class="layui-icon tb"></i></button></div>
                    <div class="layui-card-body" id="tel">

                    </div>
                </div>
            </div>
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">性别<button id="xb" type="button" class="layui-btn layui-btn-normal layui-btn-sm btn-ic"><i class="layui-icon tb"></i></button></div>
                    <div class="layui-card-body" id="sex">

                    </div>
                </div>
            </div>
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">密码(md5形式)<button id="password" type="button" class="layui-btn layui-btn-normal layui-btn-sm btn-ic"><i class="layui-icon tb"></i></button></div>
                    <div class="layui-card-body" id="pass">
                        内容
                    </div>
                </div>
            </div>
        </div>
    </div>
</article>
<footer>
    <p>Design by <a href="index.html">DCF个人博客</a> <a href="index.html">浙备-123456号</a></p>
</footer>
<script src="js/nav.js"></script>
<script type="text/javascript" src="layui/layui.js"></script>

<script>
    layui.use(['form','layer','jquery','element','laypage','upload','layedit'],function(){
        var form = layui.form;
        var layer = layui.layer;
        var upload = layui.upload;

        //普通图片上传
        function img() {
            var img;
            var uploadInst = upload.render({
                elem: '#test1'
                ,url: './uploadUserImg' //改成您自己的上传接口
                ,before: function(obj){
                    //预读本地文件示例，不支持ie8
                    obj.preview(function(index, file, result){
                        img=result;
                        $('#demo1').attr('src', result); //图片链接（base64）
                    });
                }
                ,done: function(res){
                    //如果上传失败
                    if(res.code > 1){
                        return layer.msg('上传失败');
                    }else  if(res.code=="0"){
                        $('#tximg').attr('src', img); //图片链接（base64）
                        //$("#tximg").attr('src', "./headFile/"+img);
                        return layer.msg('上传成功');
                    }
                    //上传成功
                }
                ,error: function(){
                    //演示失败状态，并实现重传
                    var demoText = $('#demoText');
                    demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                    demoText.find('.demo-reload').on('click', function(){
                        uploadInst.upload();
                    });
                }
            });
        }


        $(document).on('click', '#nc', function() {
            //layer.msg('赞成功,喜欢+1');
            var nc = document.getElementById("nick").innerText;
            var uid = document.getElementById("uid").value;
            layer.prompt({
                formType: 2,
                value: nc,
                title: '请输入新的昵称'
            }, function(value, index, elem){
                $.ajax({
                    url:'http://localhost:8080/pblog/updateUserNickname',
                    type:'post',
                    data:{"nickname":value,"id":uid},
                    dataType:'json',
                    success:function(data){

                        if(data=="1"){
                            $("#nick").empty();
                            $("#nick").html(value);
                            layer.msg("修改成功");
                            layer.close(index);
                        }else{
                            layer.msg("修改失败");
                        }

                    },
                    error:function(){
                        layer.msg("网络故障");
                    }
                })

                // alert(value); //得到value
                // $("#nick").empty();
                // $("#nick").html(value);
                // layer.close(index);
            });
        });
        $(document).on('click', '#yx', function() {
            //layer.msg('赞成功,喜欢+1');
            var email = document.getElementById("email").innerText;
            var uid = document.getElementById("uid").value;
            layer.prompt({
                formType: 2,
                value: email,
                title: '请输入新的邮箱'
            }, function(value, index, elem){
                $.ajax({
                    url:'http://localhost:8080/pblog/updateUserEmail',
                    type:'post',
                    data:{"email":value,"id":uid},
                    dataType:'json',
                    success:function(data){

                        if(data=="1"){
                            $("#email").empty();
                            $("#email").html(value);
                            layer.msg("邮箱修改成功");
                            layer.close(index);
                        }else{
                            layer.msg("修改失败");
                        }
                    },
                    error:function(){
                        layer.msg("网络故障");
                    }
                })
            });
        });
        $(document).on('click', '#sj', function() {
            //layer.msg('赞成功,喜欢+1');
            var tel = document.getElementById("tel").innerText;
            var uid = document.getElementById("uid").value;
            layer.prompt({
                formType: 2,
                value: tel,
                title: '请输入新的手机号'
            }, function(value, index, elem){
                $.ajax({
                    url:'http://localhost:8080/pblog/updateUserPhone',
                    type:'post',
                    data:{"phone":value,"id":uid},
                    dataType:'json',
                    success:function(data){

                        if(data=="1"){
                            $("#tel").empty();
                            $("#tel").html(value);
                            layer.msg("手机修改成功");
                            layer.close(index);
                        }else{
                            layer.msg("修改失败");
                        }
                    },
                    error:function(){
                        layer.msg("网络故障");
                    }
                })
            });
        });
        $(document).on('click', '#xb', function() {
            //layer.msg('赞成功,喜欢+1');
            var sex = document.getElementById("sex").innerText;
            var uid = document.getElementById("uid").value;
            layer.prompt({
                formType: 2,
                value: sex,
                title: '请输入新的性别'
            }, function(value, index, elem){
                $.ajax({
                    url:'http://localhost:8080/pblog/updateUserSex',
                    type:'post',
                    data:{"sex":value,"id":uid},
                    dataType:'json',
                    success:function(data){

                        if(data=="1"){
                            $("#sex").empty();
                            $("#sex").html(value);
                            layer.msg("性别修改成功");
                            layer.close(index);
                        }else{
                            layer.msg("修改失败");
                        }
                    },
                    error:function(){
                        layer.msg("网络故障");
                    }
                })
            });
        });
        $(document).on('click', '#password', function() {
            //layer.msg('赞成功,喜欢+1');
            var pass = document.getElementById("pass").innerText;
            var uid = document.getElementById("uid").value;
            layer.prompt({
                formType: 2,
                value: pass,
                title: '请输入新的密码'
            }, function(value, index, elem){
                $.ajax({
                    url:'http://localhost:8080/pblog/updatePass',
                    type:'post',
                    data:{"password":value,"id":uid},
                    dataType:'json',
                    success:function(data){

                        if(data=="1"){
                            $("#pass").empty();
                            $("#pass").html(value);
                            layer.msg("密码修改成功");
                            layer.close(index);
                        }else{
                            layer.msg("修改失败");
                        }
                    },
                    error:function(){
                        layer.msg("网络故障");
                    }
                })
            });
        });
        var flag=false;
        $(document).on('click', '#updateImg', function() {
            //layer.msg('赞成功,喜欢+1');
            if(!flag){
                flag=true;
                var s='<div class="layui-upload">\n' +
                    '  <button type="button" class="layui-btn" id="test1">上传图片</button>\n' +
                    '  <div class="layui-upload-list">\n' +
                    '    <img class="layui-upload-img" width="200px" height="200px" id="demo1">\n' +
                    '    <p id="demoText"></p>\n' +
                    '  </div>\n' +
                    '</div> ';
                $("#img").empty();
                $("#img").append(s);
                img();
            }else {
                $("#img").empty();
                flag=false;
            }


            // layer.prompt({
            //     formType: 2,
            //     content:s,
            //     area: ['390px', '260px'],
            //     title: '设置新头像'
            // }, function(value, index, elem){
            //     alert(value); //得到value
            //     layer.close(index);
            // });
        });

    })


</script>
<script  charset="utf-8" src="js/pblog/uinfo.js"></script>
</body>
</html>